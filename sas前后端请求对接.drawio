<mxfile host="app.diagrams.net" modified="2020-12-05T09:28:13.113Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.67 Safari/537.36 Edg/87.0.664.52" etag="cZ3zHya-9Qic0PiMGsPO" version="13.7.7" type="github">
  <diagram id="aKxTyYP6ZyNkT_M0FFs2" name="第 1 页">
    <mxGraphModel dx="922" dy="488" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="iL_Pr_LFBnxULHQearlb-2" value="&lt;font style=&quot;font-size: 21px&quot;&gt;前端&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="iL_Pr_LFBnxULHQearlb-4" value="&lt;p style=&quot;line-height: 150% ; font-size: 15px&quot;&gt;从cookie中取出token&lt;br&gt;每次请求带上Header&lt;br&gt;&lt;b&gt;&#39;Authorization&#39;:&#39;Bearer &#39;+token&lt;/b&gt;&lt;/p&gt;" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;fixedSize=1;html=1;" vertex="1" parent="1">
          <mxGeometry x="269" y="65" width="290" height="90" as="geometry" />
        </mxCell>
        <mxCell id="iL_Pr_LFBnxULHQearlb-6" value="&lt;pre style=&quot;background-color: rgb(255 , 255 , 255) ; color: rgb(0 , 0 , 0) ; font-family: &amp;#34;jetbrains mono&amp;#34; , monospace ; font-size: 15px&quot;&gt;&lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;public &lt;/span&gt;LoginUser getLoginUser(HttpServletRequest request)&lt;br&gt;{&lt;br&gt;    &lt;span style=&quot;color: #808080 ; font-style: italic&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-style: italic ; font-family: &amp;#34;宋体&amp;#34; , monospace&quot;&gt;获取请求携带的令牌&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-style: italic ; font-family: &amp;#34;宋体&amp;#34; , monospace&quot;&gt;    &lt;/span&gt;String token = getToken(request);&lt;br&gt;    &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;if &lt;/span&gt;(StringUtils.&lt;span style=&quot;font-style: italic&quot;&gt;isNotEmpty&lt;/span&gt;(token))&lt;br&gt;    {&lt;br&gt;        Claims claims = parseToken(token);&lt;br&gt;        &lt;span style=&quot;color: #808080 ; font-style: italic&quot;&gt;// &lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-style: italic ; font-family: &amp;#34;宋体&amp;#34; , monospace&quot;&gt;解析对应的权限以及用户信息&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: #808080 ; font-style: italic ; font-family: &amp;#34;宋体&amp;#34; , monospace&quot;&gt;        &lt;/span&gt;String uuid = (String) claims.get(Constants.&lt;span style=&quot;color: #660e7a ; font-weight: bold ; font-style: italic&quot;&gt;LOGIN_USER_KEY&lt;/span&gt;);&lt;br&gt;        String userKey = getTokenKey(uuid);&lt;br&gt;        LoginUser user = &lt;span style=&quot;color: #660e7a ; font-weight: bold&quot;&gt;redisCache&lt;/span&gt;.getCacheObject(userKey);&lt;br&gt;        &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;return &lt;/span&gt;user;&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;color: #000080 ; font-weight: bold&quot;&gt;return null&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="640" y="260" width="530" height="280" as="geometry" />
        </mxCell>
        <mxCell id="iL_Pr_LFBnxULHQearlb-8" value="&#xa;&#xa;&lt;div style=&quot;color: rgb(248, 248, 242); background-color: rgb(40, 42, 54); font-family: consolas, &amp;quot;courier new&amp;quot;, monospace; font-weight: normal; font-size: 19px; line-height: 26px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #bd93f9&quot;&gt;service&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;interceptors&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;request&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #50fa7b&quot;&gt;use&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #ffb86c ; font-style: italic&quot;&gt;config&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6272a4&quot;&gt;&amp;nbsp;&amp;nbsp;//&amp;nbsp;是否需要设置&amp;nbsp;token&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;&amp;nbsp;const&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #bd93f9&quot;&gt;isToken&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;=&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;(&lt;/span&gt;&lt;span style=&quot;color: #ffb86c ; font-style: italic&quot;&gt;config&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;headers&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;||&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;{})&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;isToken&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;===&lt;/span&gt;&lt;span style=&quot;color: #bd93f9&quot;&gt;&amp;nbsp;false&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;&amp;nbsp;if&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;(&lt;/span&gt;&lt;span style=&quot;color: #50fa7b&quot;&gt;getToken&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;&amp;amp;&amp;amp;&amp;nbsp;!&lt;/span&gt;&lt;span style=&quot;color: #bd93f9&quot;&gt;isToken&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;)&amp;nbsp;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #6272a4&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;让每个请求携带自定义token&amp;nbsp;请根据实际情况自行修改&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #ffb86c ; font-style: italic&quot;&gt;config&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;headers[&lt;/span&gt;&lt;span style=&quot;color: #e9f284&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color: #f1fa8c&quot;&gt;Authorization&lt;/span&gt;&lt;span style=&quot;color: #e9f284&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;=&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #e9f284&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color: #f1fa8c&quot;&gt;Bearer&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #e9f284&quot;&gt;&#39;&lt;/span&gt;&lt;span style=&quot;color: #ff79c6&quot;&gt;&amp;nbsp;+&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #50fa7b&quot;&gt;getToken&lt;/span&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;()&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #f8f8f2&quot;&gt;&amp;nbsp;&amp;nbsp;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&#xa;&#xa;" style="text;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="640" width="550" height="200" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
